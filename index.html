<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MyFXBook Wirtschaftskalender</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .event { border-bottom: 1px solid #ddd; padding: 10px 0; }
        .event strong { color: #0056b3; }
    </style>
</head>
<body>
    <h2>Forex Wirtschaftskalender (MyFXBook)</h2>
    <div id="calendar">Lade Daten...</div>

    <script>
        let sessionID = null;

        async function loginMyFXBook() {
            if (sessionID) {
                return sessionID; // Falls eine Session existiert, verwende sie.
            }

            const API_EMAIL = "fabian-firsching@mail.de"; // Jetzt mit "email="
            const API_PASSWORD = "444Ghv67"; // Falls Sonderzeichen, teste ohne

            const loginUrl = `https://www.myfxbook.com/api/login.json?email=${encodeURIComponent(API_EMAIL)}&password=${encodeURIComponent(API_PASSWORD)}`;

            try {
                const response = await fetch(loginUrl);
                const data = await response.json();

                if (data.error) {
                    throw new Error(`API-Login fehlgeschlagen: ${data.message}`);
                }

                sessionID = data.session; // Speichere die Session-ID
                return sessionID;
            } catch (error) {
                console.error("API-Login Fehler:", error);
                document.getElementById("calendar").innerHTML = "❌ Fehler bei der API-Anmeldung!";
                return null;
            }
        }

        async function loadEconomicCalendar(session) {
            const url = `https://www.myfxbook.com/api/get-economic-calendar.json?session=${session}`;

            try {
                const response = await fetch(url);
                const data = await response.json();

                if (!data.economicCalendar) {
                    document.getElementById("calendar").innerHTML = "⚠ Keine Wirtschaftsdaten verfügbar.";
                    return;
                }

                let events = "";
                data.economicCalendar.forEach(event => {
                    events += `<div class="event">
                                    <strong>${event.date}</strong> - <span>${event.currency}</span> - ${event.title} <br>
                                    <em>Impact: ${event.impact}, Vorherige: ${event.previous}, Prognose: ${event.forecast}</em>
                               </div>`;
                });

                document.getElementById("calendar").innerHTML = events;
            } catch (error) {
                console.error("Fehler beim Laden des Wirtschaftskalenders:", error);
                document.getElementById("calendar").innerHTML = "❌ Fehler beim Laden der Wirtschaftsdaten.";
            }
        }

        async function fetchData() {
            const session = await loginMyFXBook();
            if (session) {
                loadEconomicCalendar(session);
            }
        }

        fetchData();
    </script>
</body>
</html>
